2025-09-12 11:29:31 INFO: - Rank: -1, Saving log file to checkpoint/llama3/evaluation_w_0.9.log ...
2025-09-12 11:29:31 INFO: - Loading data from /home/jiangjp/trace-idea/data/musique/musique_dev100ideal_with_reasoning_chains_modify_w09.json ... 
从文件名自动解析得到权重: w = 0.9
权重值: 0.9
输入文件: /home/jiangjp/trace-idea/data/musique/musique_dev100ideal_with_reasoning_chains_modify_w09.json
日志文件: checkpoint/llama3/evaluation_w_0.9.log
正在加载数据集...
正在加载分词器: "/home/jiangjp/models/Meta-Llama-3-8B-Instruct"，padding_side: "left"
缺少padding token，设置padding token为eos_token
正在加载模型...
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:01<00:03,  1.07s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:02<00:02,  1.16s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:03<00:01,  1.16s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:03<00:00,  1.28it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:03<00:00,  1.09it/s]
开始评估...
正在评估权重 w = 0.9
输入文件: /home/jiangjp/trace-idea/data/musique/musique_dev100ideal_with_reasoning_chains_modify_w09.json
数据集大小: 100
评估 w=0.9:   0%|          | 0/25 [00:00<?, ?it/s]/home/jiangjp/miniconda3/envs/trace/lib/python3.10/site-packages/transformers/generation/configuration_utils.py:497: UserWarning: `do_sample` is set to `False`. However, `top_p` is set to `0.9` -- this flag is only used in sample-based generation modes. You should set `do_sample=True` or unset `top_p`.
  warnings.warn(
评估 w=0.9:   4%|▍         | 1/25 [00:04<01:42,  4.29s/it]评估 w=0.9:   8%|▊         | 2/25 [00:07<01:20,  3.49s/it]评估 w=0.9:  12%|█▏        | 3/25 [00:11<01:21,  3.71s/it]评估 w=0.9:  16%|█▌        | 4/25 [00:16<01:31,  4.36s/it]评估 w=0.9:  20%|██        | 5/25 [00:21<01:30,  4.54s/it]评估 w=0.9:  24%|██▍       | 6/25 [00:26<01:30,  4.76s/it]评估 w=0.9:  28%|██▊       | 7/25 [00:29<01:16,  4.24s/it]评估 w=0.9:  32%|███▏      | 8/25 [00:35<01:17,  4.58s/it]评估 w=0.9:  36%|███▌      | 9/25 [00:38<01:05,  4.12s/it]评估 w=0.9:  40%|████      | 10/25 [00:41<00:57,  3.85s/it]评估 w=0.9:  44%|████▍     | 11/25 [00:47<01:02,  4.49s/it]评估 w=0.9:  48%|████▊     | 12/25 [00:52<00:59,  4.55s/it]评估 w=0.9:  52%|█████▏    | 13/25 [00:56<00:54,  4.52s/it]评估 w=0.9:  56%|█████▌    | 14/25 [01:01<00:50,  4.55s/it]评估 w=0.9:  60%|██████    | 15/25 [01:06<00:49,  4.95s/it]评估 w=0.9:  64%|██████▍   | 16/25 [01:12<00:45,  5.10s/it]评估 w=0.9:  68%|██████▊   | 17/25 [01:14<00:34,  4.31s/it]评估 w=0.9:  72%|███████▏  | 18/25 [01:19<00:31,  4.44s/it]评估 w=0.9:  76%|███████▌  | 19/25 [01:29<00:36,  6.13s/it]评估 w=0.9:  80%|████████  | 20/25 [01:33<00:27,  5.41s/it]样本0 错误:
  生成答案: '1861'
  正确答案: ['April 1858']
  最佳正确答案概率: 0.223072 ('April 1858')
样本2 错误:
  生成答案: 'Yerevan'
  正确答案: ['Kapan']
  最佳正确答案概率: 0.000000 ('Kapan')
样本3 错误:
  生成答案: 'Russian Delegation'
  正确答案: ['Chinese']
  最佳正确答案概率: 0.000004 ('Chinese')
样本7 错误:
  生成答案: 'hotel and restaurant'
  正确答案: ['hotels', 'Hotel', 'hotel']
  最佳正确答案概率: 0.653942 ('hotel')
样本9 错误:
  生成答案: 'Ecclesiastical Province of Canada'
  正确答案: ['Anglican Church of Canada']
  最佳正确答案概率: 0.000008 ('Anglican Church of Canada')
样本10 错误:
  生成答案: '6'
  正确答案: ['three']
  最佳正确答案概率: 0.000014 ('three')
样本13 错误:
  生成答案: 'Beijing'
  正确答案: ['Dorgon']
  最佳正确答案概率: 0.000000 ('Dorgon')
样本14 错误:
  生成答案: 'Christians'
  正确答案: ['a red cross on a white field', 'Red Cross']
  最佳正确答案概率: 0.000000 ('Red Cross')
样本16 错误:
  生成答案: 'Princeton University'
  正确答案: ['Syracuse University', 'Cuse', 'SU']
  最佳正确答案概率: 0.000006 ('Syracuse University')
样本17 错误:
  生成答案: '1945'
  正确答案: ['1842']
  最佳正确答案概率: 0.000008 ('1842')
样本18 错误:
  生成答案: 'German Wehrmacht'
  正确答案: ['KPA']
  最佳正确答案概率: 0.000214 ('KPA')
样本20 错误:
  生成答案: 'Ireland'
  正确答案: ['Norway', 'NO', 'NOR', 'no']
  最佳正确答案概率: 0.000002 ('Norway')
样本22 错误:
  生成答案: '27 BC'
  正确答案: ['establishment of the Roman Empire.', 'Roman Empire']
  最佳正确答案概率: 0.000458 ('Roman Empire')
样本23 错误:
  生成答案: 'Indiana University and the New England Conservatory of Music.'
  正确答案: ['Visva-Bharati University']
  最佳正确答案概率: 0.000000 ('Visva-Bharati University')
样本24 错误:
  生成答案: 'Sicily.'
  正确答案: ['1773']
  最佳正确答案概率: 0.000000 ('1773')
样本25 错误:
  生成答案: 'The Persian Empire.'
  正确答案: ['Kurdish people']
  最佳正确答案概率: 0.000000 ('Kurdish people')
样本27 错误:
  生成答案: 'Peter Grant and Swan Song Records.'
  正确答案: ['Peter Grant']
  最佳正确答案概率: 0.987236 ('Peter Grant')
样本28 错误:
  生成答案: 'Asia'
  正确答案: ['Central Asia']
  最佳正确答案概率: 0.000002 ('Central Asia')
样本33 错误:
  生成答案: 'Michelangelo'
  正确答案: ['Italian painter']
  最佳正确答案概率: 0.000000 ('Italian painter')
样本34 错误:
  生成答案: 'Jim McCartney'
  正确答案: ['Alfred Lennon']
  最佳正确答案概率: 0.000735 ('Alfred Lennon')
样本35 错误:
  生成答案: 'Mendelssohn & Co.'
  正确答案: ['KaDeWe']
  最佳正确答案概率: 0.144163 ('KaDeWe')
样本38 错误:
  生成答案: 'Laughery Creek'
  正确答案: ['Ohio River']
  最佳正确答案概率: 0.002752 ('Ohio River')
样本39 错误:
  生成答案: '1950'
  正确答案: ['1963']
  最佳正确答案概率: 0.000003 ('1963')
样本40 错误:
  生成答案: 'by a considerable margin'
  正确答案: ["Europe's most innovative country", 'Europe']
  最佳正确答案概率: 0.005365 ('Europe')
样本41 错误:
  生成答案: '$100,000'
  正确答案: ['$122,160']
  最佳正确答案概率: 0.010220 ('$122,160')
样本43 错误:
  生成答案: '1945'
  正确答案: ['December 1917']
  最佳正确答案概率: 0.000000 ('December 1917')
样本45 错误:
  生成答案: '1842'
  正确答案: ['1895']
  最佳正确答案概率: 0.003035 ('1895')
样本46 错误:
  生成答案: 'July 1960'
  正确答案: ['represented the island of Puerto Rico', 'PR', 'Puerto Rico']
  最佳正确答案概率: 0.000000 ('Puerto Rico')
样本47 错误:
  生成答案: 'church'
  正确答案: ['temple, now a church', 'Temple', 'temple']
  最佳正确答案概率: 0.000001 ('Temple')
样本48 错误:
  生成答案: '597'
  正确答案: ['1909']
  最佳正确答案概率: 0.000000 ('1909')
样本49 错误:
  生成答案: '24 hours'
  正确答案: ['24 hours a day']
  最佳正确答案概率: 0.064947 ('24 hours a day')
样本50 正确:
  生成答案: 'Antarctica'
  最佳正确答案概率: 0.999227 ('Antarctica')
样本51 错误:
  生成答案: 'Federal Highway Administration (FHWA)'
  正确答案: ['Rhode Island Department of Transportation', 'RIDOT']
  最佳正确答案概率: 0.000001 ('RIDOT')
样本52 错误:
  生成答案: 'No one signed the Declaration of Independence from the state where Keedy House is located, because Keedy House is located in Maryland'
  正确答案: ['Charles Carroll']
  最佳正确答案概率: 0.000000 ('Charles Carroll')
样本53 错误:
  生成答案: 'Castel Gandolfo, near Rome'
  正确答案: ['Castel Gandolfo']
  最佳正确答案概率: 0.896434 ('Castel Gandolfo')
样本55 错误:
  生成答案: 'Shirley Temple'
  正确答案: ['Catherine Zeta-Jones']
  最佳正确答案概率: 0.000000 ('Catherine Zeta-Jones')
样本56 错误:
  生成答案: 'tsampa'
  正确答案: ['yak meat']
  最佳正确答案概率: 0.000004 ('yak meat')
样本58 错误:
  生成答案: 'Lewis Range'
  正确答案: ['Rocky Mountains']
  最佳正确答案概率: 0.000716 ('Rocky Mountains')
样本60 错误:
  生成答案: 'Voyager 2'
  正确答案: ['Voyager probes']
  最佳正确答案概率: 0.041584 ('Voyager probes')
样本61 错误:
  生成答案: 'The Voice'
  正确答案: ['American Idol']
  最佳正确答案概率: 0.007780 ('American Idol')
样本63 错误:
  生成答案: 'December 1, 44 AD'
  正确答案: ['March 44 BC']
  最佳正确答案概率: 0.000084 ('March 44 BC')
样本64 错误:
  生成答案: 'Menlo Park'
  正确答案: ['Harper Simon']
  最佳正确答案概率: 0.007467 ('Harper Simon')
样本65 错误:
  生成答案: '13 February 1937'
  正确答案: ['six months']
  最佳正确答案概率: 0.000001 ('six months')
样本68 错误:
  生成答案: 'Ferdinand Porsche'
  正确答案: ['Louis Renault']
  最佳正确答案概率: 0.000000 ('Louis Renault')
样本69 错误:
  生成答案: 'MES-2'
  正确答案: ['WGL-4 with 652 characters']
  最佳正确答案概率: 0.003486 ('WGL-4 with 652 characters')
样本71 错误:
  生成答案: 'Members of the Lok Sabha.'
  正确答案: ['Parliament of India']
  最佳正确答案概率: 0.000000 ('Parliament of India')
样本72 错误:
  生成答案: 'Stanford University.'
  正确答案: ['Harvard']
  最佳正确答案概率: 0.496720 ('Harvard')
样本73 错误:
  生成答案: '1. Chicago Cubs reason for poor late-season play unusually high number of day games.'
  正确答案: ['unusually high number of day games', 'd', 'day', 'Day', 'days']
  最佳正确答案概率: 0.166951 ('Day')
样本74 错误:
  生成答案: 'An entire year.'
  正确答案: ['a month', 'Month', 'month']
  最佳正确答案概率: 0.000000 ('Month')
样本75 错误:
  生成答案: 'No.'
  正确答案: ['totals remain relatively small in relation to the total U.S population.', 'the US', 'America', 'U.S.', 'the United States', 'United States', 'US']
  最佳正确答案概率: 0.000000 ('United States')
样本77 错误:
  生成答案: 'Charlottesville, Virginia'
  正确答案: ['Lincoln Financial Field']
  最佳正确答案概率: 0.000011 ('Lincoln Financial Field')
样本78 错误:
  生成答案: 'José Feliciano'
  正确答案: ['Aldemaro Romero']
  最佳正确答案概率: 0.000000 ('Aldemaro Romero')
样本79 错误:
  生成答案: 'Penelope Cruz'
  正确答案: ['Amna Ilyas']
  最佳正确答案概率: 0.000000 ('Amna Ilyas')
样本80 错误:
  生成答案: 'United Kingdom'
  正确答案: ['off the north - western coast of the European mainland']
  最佳正确答案概率: 0.000000 ('off the north - western coast of the European mainland')
样本81 错误:
  生成答案: 'Puerto Rico'
  正确答案: ['a key part of the Spanish Empire']
  最佳正确答案概率: 0.000000 ('a key part of the Spanish Empire')
样本82 错误:
评估 w=0.9:  84%|████████▍ | 21/25 [01:41<00:24,  6.21s/it]评估 w=0.9:  88%|████████▊ | 22/25 [01:43<00:14,  4.87s/it]评估 w=0.9:  92%|█████████▏| 23/25 [01:46<00:08,  4.34s/it]评估 w=0.9:  96%|█████████▌| 24/25 [01:50<00:04,  4.21s/it]评估 w=0.9: 100%|██████████| 25/25 [01:57<00:00,  5.13s/it]评估 w=0.9: 100%|██████████| 25/25 [01:57<00:00,  4.70s/it]
2025-09-12 11:31:42 INFO: - 评估完成
2025-09-12 11:31:42 INFO: - 权重值: 0.9
2025-09-12 11:31:42 INFO: - 输入文件: /home/jiangjp/trace-idea/data/musique/musique_dev100ideal_with_reasoning_chains_modify_w09.json
2025-09-12 11:31:42 INFO: - 评估结果: {'weight_w': 0.9, 'input_file': '/home/jiangjp/trace-idea/data/musique/musique_dev100ideal_with_reasoning_chains_modify_w09.json', 'total_samples': 100, 'exact_match': 0.34, 'f1': 0.37876190476190474, 'precision': 0.3928690476190477, 'recall': 0.38716666666666666, 'avg_max_log_prob': -8.375383023469409, 'avg_max_prob': 0.3199515465011651, 'avg_total_prob': 0.3402320300412381, 'valid_max_prob_samples': 100, 'invalid_max_prob_samples': 0, 'avg_answer_count': 1.48, 'avg_valid_answer_count': 1.48}
2025-09-12 11:31:42 INFO: - 结果已保存至: /home/jiangjp/trace-idea/results/myidea/MuSiQue/fakenum1/idealsetting/w09/sample_correct_probabilities_w_0.9_triples.json
  生成答案: '171,016'
  正确答案: ['165,521']
  最佳正确答案概率: 0.000000 ('165,521')
样本86 错误:
  生成答案: 'Mattel'
  正确答案: ['Elliot Handler']
  最佳正确答案概率: 0.249839 ('Elliot Handler')
样本88 错误:
  生成答案: 'Governor'
  正确答案: ['Arkansas Attorney General']
  最佳正确答案概率: 0.000000 ('Arkansas Attorney General')
样本89 错误:
  生成答案: 'Def Jam Recordings'
  正确答案: ['RCA Records', 'RCA']
  最佳正确答案概率: 0.000003 ('RCA')
样本90 错误:
  生成答案: 'Yerevan'
  正确答案: ['Kapan']
  最佳正确答案概率: 0.203341 ('Kapan')
样本91 错误:
  生成答案: 'Trajan'
  正确答案: ['Marcia']
  最佳正确答案概率: 0.004227 ('Marcia')
样本93 错误:
  生成答案: 'The Near East.'
  正确答案: ['"the East Indies"', 'East Indies']
  最佳正确答案概率: 0.000000 ('East Indies')
样本94 错误:
  生成答案: '1775'
  正确答案: ['1824']
  最佳正确答案概率: 0.000105 ('1824')
样本95 错误:
  生成答案: 'Nintendo'
  正确答案: ['first-party games']
  最佳正确答案概率: 0.000000 ('first-party games')
样本96 错误:
  生成答案: 'Canada'
  正确答案: ['United States', 'US of A', 'U.S.', 'US', 'U.S']
  最佳正确答案概率: 0.000466 ('United States')
样本98 错误:
  生成答案: 'Nathan Green, Rhode Island'
  正确答案: ['Seth Magaziner']
  最佳正确答案概率: 0.033525 ('Seth Magaziner')
样本99 错误:
  生成答案: 'Lin'an'
  正确答案: ['Qiantang']
  最佳正确答案概率: 0.000000 ('Qiantang')

============================================================
评估结果
============================================================
weight_w: 0.900000
input_file: /home/jiangjp/trace-idea/data/musique/musique_dev100ideal_with_reasoning_chains_modify_w09.json
total_samples: 100
exact_match: 0.340000
f1: 0.378762
precision: 0.392869
recall: 0.387167
avg_max_log_prob: -8.375383
avg_max_prob: 0.319952
avg_total_prob: 0.340232
valid_max_prob_samples: 100
invalid_max_prob_samples: 0
avg_answer_count: 1.480000
avg_valid_answer_count: 1.480000
============================================================

结果已保存至: /home/jiangjp/trace-idea/results/myidea/MuSiQue/fakenum1/idealsetting/w09/sample_correct_probabilities_w_0.9_triples.json

统计信息:
平均每个问题有 1.5 个正确答案
平均每个问题有 1.5 个有效概率的答案
有效概率样本: 100 / 100
