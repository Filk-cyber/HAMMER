2025-09-12 10:28:42 INFO: - Rank: -1, Saving log file to checkpoint/llama3/evaluation_w_0.2.log ...
2025-09-12 10:28:42 INFO: - Loading data from /home/jiangjp/trace-idea/data/musique/musique_dev100ideal_with_reasoning_chains_modify_w02.json ... 
从文件名自动解析得到权重: w = 0.2
权重值: 0.2
输入文件: /home/jiangjp/trace-idea/data/musique/musique_dev100ideal_with_reasoning_chains_modify_w02.json
日志文件: checkpoint/llama3/evaluation_w_0.2.log
正在加载数据集...
正在加载分词器: "/home/jiangjp/models/Meta-Llama-3-8B-Instruct"，padding_side: "left"
缺少padding token，设置padding token为eos_token
正在加载模型...
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|██▌       | 1/4 [00:01<00:03,  1.10s/it]Loading checkpoint shards:  50%|█████     | 2/4 [00:02<00:02,  1.17s/it]Loading checkpoint shards:  75%|███████▌  | 3/4 [00:03<00:01,  1.16s/it]Loading checkpoint shards: 100%|██████████| 4/4 [00:03<00:00,  1.29it/s]Loading checkpoint shards: 100%|██████████| 4/4 [00:03<00:00,  1.09it/s]
开始评估...
正在评估权重 w = 0.2
输入文件: /home/jiangjp/trace-idea/data/musique/musique_dev100ideal_with_reasoning_chains_modify_w02.json
数据集大小: 100
评估 w=0.2:   0%|          | 0/25 [00:00<?, ?it/s]/home/jiangjp/miniconda3/envs/trace/lib/python3.10/site-packages/transformers/generation/configuration_utils.py:497: UserWarning: `do_sample` is set to `False`. However, `top_p` is set to `0.9` -- this flag is only used in sample-based generation modes. You should set `do_sample=True` or unset `top_p`.
  warnings.warn(
评估 w=0.2:   4%|▍         | 1/25 [00:16<06:28, 16.21s/it]评估 w=0.2:   8%|▊         | 2/25 [00:26<04:46, 12.47s/it]评估 w=0.2:  12%|█▏        | 3/25 [00:32<03:31,  9.61s/it]评估 w=0.2:  16%|█▌        | 4/25 [00:48<04:18, 12.32s/it]评估 w=0.2:  20%|██        | 5/25 [00:55<03:24, 10.21s/it]评估 w=0.2:  24%|██▍       | 6/25 [01:17<04:34, 14.46s/it]评估 w=0.2:  28%|██▊       | 7/25 [01:35<04:38, 15.48s/it]评估 w=0.2:  32%|███▏      | 8/25 [01:59<05:07, 18.08s/it]评估 w=0.2:  36%|███▌      | 9/25 [02:04<03:44, 14.06s/it]评估 w=0.2:  40%|████      | 10/25 [02:16<03:20, 13.33s/it]评估 w=0.2:  44%|████▍     | 11/25 [02:29<03:07, 13.41s/it]评估 w=0.2:  48%|████▊     | 12/25 [02:49<03:19, 15.34s/it]评估 w=0.2:  52%|█████▏    | 13/25 [03:05<03:05, 15.44s/it]评估 w=0.2:  56%|█████▌    | 14/25 [03:19<02:47, 15.24s/it]评估 w=0.2:  60%|██████    | 15/25 [03:34<02:30, 15.04s/it]评估 w=0.2:  64%|██████▍   | 16/25 [03:55<02:31, 16.80s/it]评估 w=0.2:  68%|██████▊   | 17/25 [04:01<01:49, 13.72s/it]评估 w=0.2:  72%|███████▏  | 18/25 [04:14<01:34, 13.48s/it]评估 w=0.2:  76%|███████▌  | 19/25 [04:43<01:47, 17.97s/it]评估 w=0.2:  80%|████████  | 20/25 [04:49<01:12, 14.54s/it]评估 w=0.2:  84%|████████▍ | 21/25 [05:09<01:04, 16.06s/it]样本0 错误:
  生成答案: '1858'
  正确答案: ['April 1858']
  最佳正确答案概率: 0.390831 ('April 1858')
样本3 错误:
  生成答案: 'None of the provided contexts mention peace talks in Geneva with a country that approved the name of the planet that features the Small Dark'
  正确答案: ['Chinese']
  最佳正确答案概率: 0.000004 ('Chinese')
样本5 错误:
  生成答案: 'According to the context, the Mississippi River begins in Lake Itasca in northern Minnesota. According to the first context, Minnesota's'
  正确答案: ['1.7 million']
  最佳正确答案概率: 0.033022 ('1.7 million')
样本7 错误:
  生成答案: 'Hotel and restaurant.'
  正确答案: ['hotels', 'Hotel', 'hotel']
  最佳正确答案概率: 0.447415 ('Hotel')
样本10 错误:
  生成答案: '3'
  正确答案: ['three']
  最佳正确答案概率: 0.005698 ('three')
样本12 错误:
  生成答案: '1898'
  正确答案: ['August 12, 1898']
  最佳正确答案概率: 0.000555 ('August 12, 1898')
样本13 错误:
  生成答案: 'China'
  正确答案: ['Dorgon']
  最佳正确答案概率: 0.000000 ('Dorgon')
样本14 错误:
  生成答案: 'Christians.'
  正确答案: ['a red cross on a white field', 'Red Cross']
  最佳正确答案概率: 0.000000 ('Red Cross')
样本15 错误:
  生成答案: 'Columbia Records.'
  正确答案: ['Warner Bros.']
  最佳正确答案概率: 0.000000 ('Warner Bros.')
样本16 错误:
  生成答案: 'Berklee College of Music'
  正确答案: ['Syracuse University', 'Cuse', 'SU']
  最佳正确答案概率: 0.000000 ('Syracuse University')
样本18 错误:
  生成答案: 'South Korea'
  正确答案: ['KPA']
  最佳正确答案概率: 0.000000 ('KPA')
样本22 错误:
  生成答案: '27 BC'
  正确答案: ['establishment of the Roman Empire.', 'Roman Empire']
  最佳正确答案概率: 0.000024 ('establishment of the Roman Empire.')
样本23 错误:
  生成答案: 'The composer of Ganashatru is not mentioned in the given contexts. Ganashatru is a film directed by Sat'
  正确答案: ['Visva-Bharati University']
  最佳正确答案概率: 0.000000 ('Visva-Bharati University')
样本24 错误:
  生成答案: 'There is no mention of the XXX Corps invading an island in the given context.'
  正确答案: ['1773']
  最佳正确答案概率: 0.000000 ('1773')
样本26 错误:
  生成答案: 'St. John's.'
  正确答案: ['eastern tip']
  最佳正确答案概率: 0.004541 ('eastern tip')
样本28 错误:
  生成答案: 'Asia'
  正确答案: ['Central Asia']
  最佳正确答案概率: 0.000033 ('Central Asia')
样本29 错误:
  生成答案: 'There is no mention of the performer of "Walk on the Wild Side" in the given contexts. The contexts are about Lucky'
  正确答案: ['Syracuse University', 'Cuse', 'SU']
  最佳正确答案概率: 0.000000 ('Syracuse University')
样本33 错误:
  生成答案: 'Painter'
  正确答案: ['Italian painter']
  最佳正确答案概率: 0.000048 ('Italian painter')
样本34 错误:
  生成答案: 'John Lennon'
  正确答案: ['Alfred Lennon']
  最佳正确答案概率: 0.000001 ('Alfred Lennon')
样本35 错误:
  生成答案: 'Macy's'
  正确答案: ['KaDeWe']
  最佳正确答案概率: 0.000000 ('KaDeWe')
样本37 错误:
  生成答案: 'May 14, 2015'
  正确答案: ['September 25, 2014']
  最佳正确答案概率: 0.002147 ('September 25, 2014')
样本38 错误:
  生成答案: 'Laughery Creek'
  正确答案: ['Ohio River']
  最佳正确答案概率: 0.000889 ('Ohio River')
样本40 错误:
  生成答案: 'The European Union.'
  正确答案: ["Europe's most innovative country", 'Europe']
  最佳正确答案概率: 0.012787 ('Europe')
样本43 错误:
  生成答案: 'There is no mention of Alanders rejoining the country in the given contexts.'
  正确答案: ['December 1917']
  最佳正确答案概率: 0.000000 ('December 1917')
样本45 错误:
  生成答案: 'Not applicable, as the question is unclear and does not specify the president's father.'
  正确答案: ['1895']
  最佳正确答案概率: 0.000001 ('1895')
样本46 错误:
  生成答案: 'The flag of Australia has one star.'
  正确答案: ['represented the island of Puerto Rico', 'PR', 'Puerto Rico']
  最佳正确答案概率: 0.000000 ('PR')
样本47 错误:
  生成答案: 'a church'
  正确答案: ['temple, now a church', 'Temple', 'temple']
  最佳正确答案概率: 0.000004 ('Temple')
样本48 错误:
  生成答案: '597'
  正确答案: ['1909']
  最佳正确答案概率: 0.000002 ('1909')
样本49 错误:
  生成答案: '23:00'
  正确答案: ['24 hours a day']
  最佳正确答案概率: 0.021039 ('24 hours a day')
样本50 正确:
  生成答案: 'Antarctica'
  最佳正确答案概率: 0.999147 ('Antarctica')
样本51 错误:
  生成答案: 'Rhode Island.'
  正确答案: ['Rhode Island Department of Transportation', 'RIDOT']
  最佳正确答案概率: 0.145267 ('Rhode Island Department of Transportation')
样本52 错误:
  生成答案: 'None of the signers of the Declaration of Independence were from the state where Keedy House is located, which is Maryland.'
  正确答案: ['Charles Carroll']
  最佳正确答案概率: 0.006089 ('Charles Carroll')
样本53 错误:
  生成答案: 'Rome'
  正确答案: ['Castel Gandolfo']
  最佳正确答案概率: 0.000259 ('Castel Gandolfo')
样本54 错误:
  生成答案: 'Thomas Stone'
  正确答案: ['Charles Carroll']
  最佳正确答案概率: 0.025086 ('Charles Carroll')
样本55 错误:
  生成答案: 'Widower.'
  正确答案: ['Catherine Zeta-Jones']
  最佳正确答案概率: 0.000250 ('Catherine Zeta-Jones')
样本56 错误:
  生成答案: 'Barley.'
  正确答案: ['yak meat']
  最佳正确答案概率: 0.000077 ('yak meat')
样本58 错误:
  生成答案: 'Lewis Range'
  正确答案: ['Rocky Mountains']
  最佳正确答案概率: 0.000001 ('Rocky Mountains')
样本60 错误:
  生成答案: 'The Voyager 1 and Voyager 2 spacecraft used the gravitational pull of Jupiter.'
  正确答案: ['Voyager probes']
  最佳正确答案概率: 0.001090 ('Voyager probes')
样本62 错误:
  生成答案: '1310-14'
  正确答案: ['5th–6th centuries', '6th century', '6th-century']
  最佳正确答案概率: 0.000021 ('6th century')
样本63 错误:
  生成答案: 'Julius Caesar'
  正确答案: ['March 44 BC']
  最佳正确答案概率: 0.000000 ('March 44 BC')
样本68 错误:
  生成答案: 'Renault'
  正确答案: ['Louis Renault']
  最佳正确答案概率: 0.000000 ('Louis Renault')
样本69 错误:
  生成答案: 'UTF-16'
  正确答案: ['WGL-4 with 652 characters']
  最佳正确答案概率: 0.000000 ('WGL-4 with 652 characters')
样本71 错误:
  生成答案: 'members of the Lok Sabha'
  正确答案: ['Parliament of India']
  最佳正确答案概率: 0.000001 ('Parliament of India')
样本72 错误:
  生成答案: 'Harvard University'
  正确答案: ['Harvard']
  最佳正确答案概率: 0.698148 ('Harvard')
样本74 错误:
  生成答案: 'A month-long affair.'
  正确答案: ['a month', 'Month', 'month']
  最佳正确答案概率: 0.108939 ('a month')
样本75 错误:
  生成答案: 'No.'
  正确答案: ['totals remain relatively small in relation to the total U.S population.', 'the US', 'America', 'U.S.', 'the United States', 'United States', 'US']
  最佳正确答案概率: 0.000000 ('U.S.')
样本80 错误:
  生成答案: 'Hemel Hempstead, United Kingdom'
  正确答案: ['off the north - western coast of the European mainland']
  最佳正确答案概率: 0.000000 ('off the north - western coast of the European mainland')
样本81 错误:
  生成答案: 'Puerto Rico'
  正确答案: ['a key part of the Spanish Empire']
  最佳正确答案概率: 0.000000 ('a key part of the Spanish Empire')
样本82 错误:
  生成答案: 'Fort Lauderdale'
  正确答案: ['165,521']
  最佳正确答案概率: 0.000005 ('165,521')
样本83 错误:
  生成答案: 'Arun Jaitley'
  正确答案: ['Sudhir Mungantiwar']
  最佳正确答案概率: 0.002184 ('Sudhir Mungantiwar')
样本86 错误:
  生成答案: 'Mattel.'
  正确答案: ['Elliot Handler']
评估 w=0.2:  88%|████████▊ | 22/25 [05:16<00:39, 13.29s/it]评估 w=0.2:  92%|█████████▏| 23/25 [05:32<00:28, 14.08s/it]评估 w=0.2:  96%|█████████▌| 24/25 [05:47<00:14, 14.46s/it]评估 w=0.2: 100%|██████████| 25/25 [06:09<00:00, 16.79s/it]评估 w=0.2: 100%|██████████| 25/25 [06:09<00:00, 14.79s/it]
2025-09-12 10:35:05 INFO: - 评估完成
2025-09-12 10:35:05 INFO: - 权重值: 0.2
2025-09-12 10:35:05 INFO: - 输入文件: /home/jiangjp/trace-idea/data/musique/musique_dev100ideal_with_reasoning_chains_modify_w02.json
2025-09-12 10:35:05 INFO: - 评估结果: {'weight_w': 0.2, 'input_file': '/home/jiangjp/trace-idea/data/musique/musique_dev100ideal_with_reasoning_chains_modify_w02.json', 'total_samples': 100, 'exact_match': 0.44, 'f1': 0.49664235764235765, 'precision': 0.5240757575757575, 'recall': 0.49400000000000005, 'avg_max_log_prob': -6.625611402013394, 'avg_max_prob': 0.3647756742019594, 'avg_total_prob': 0.38336323911290393, 'valid_max_prob_samples': 100, 'invalid_max_prob_samples': 0, 'avg_answer_count': 1.48, 'avg_valid_answer_count': 1.48}
2025-09-12 10:35:05 INFO: - 结果已保存至: /home/jiangjp/trace-idea/results/myidea/MuSiQue/fakenum1/idealsetting/w02/sample_correct_probabilities_w_0.2_documents.json
  最佳正确答案概率: 0.490128 ('Elliot Handler')
样本88 错误:
  生成答案: 'Bill Clinton'
  正确答案: ['Arkansas Attorney General']
  最佳正确答案概率: 0.000000 ('Arkansas Attorney General')
样本91 错误:
  生成答案: 'unknown.'
  正确答案: ['Marcia']
  最佳正确答案概率: 0.000196 ('Marcia')
样本95 错误:
  生成答案: 'Nintendo'
  正确答案: ['first-party games']
  最佳正确答案概率: 0.000000 ('first-party games')
样本97 错误:
  生成答案: 'Giorgio de Chirico'
  正确答案: ['Alberto Savinio']
  最佳正确答案概率: 0.100343 ('Alberto Savinio')
样本98 错误:
  生成答案: 'Seth Magaziner, Rhode Island'
  正确答案: ['Seth Magaziner']
  最佳正确答案概率: 0.593407 ('Seth Magaziner')
样本99 错误:
  生成答案: 'Bianjing'
  正确答案: ['Qiantang']
  最佳正确答案概率: 0.000003 ('Qiantang')

============================================================
评估结果
============================================================
weight_w: 0.200000
input_file: /home/jiangjp/trace-idea/data/musique/musique_dev100ideal_with_reasoning_chains_modify_w02.json
total_samples: 100
exact_match: 0.440000
f1: 0.496642
precision: 0.524076
recall: 0.494000
avg_max_log_prob: -6.625611
avg_max_prob: 0.364776
avg_total_prob: 0.383363
valid_max_prob_samples: 100
invalid_max_prob_samples: 0
avg_answer_count: 1.480000
avg_valid_answer_count: 1.480000
============================================================

结果已保存至: /home/jiangjp/trace-idea/results/myidea/MuSiQue/fakenum1/idealsetting/w02/sample_correct_probabilities_w_0.2_documents.json

统计信息:
平均每个问题有 1.5 个正确答案
平均每个问题有 1.5 个有效概率的答案
有效概率样本: 100 / 100
